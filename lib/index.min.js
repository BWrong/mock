!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("url"),require("chokidar"),require("chalk"),require("body-parser"),require("path-to-regexp"),require("path"),require("mockjs"),require("glob")):"function"==typeof define&&define.amd?define(["url","chokidar","chalk","body-parser","path-to-regexp","path","mockjs","glob"],r):(e="undefined"!=typeof globalThis?globalThis:e||self).mockTool=r(e.URL,e.chokidar,e.chalk,e.bodyParser,e.require$$1,e.require$$0,e.Mock,e.glob)}(this,(function(e,r,t,n,o,c,a,i){"use strict";function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=u(e),s=u(r),d=u(t),f=u(n),p=u(o),h=u(c),m=u(a),v=u(i);function b(e,r,t,n,o,c,a){try{var i=e[c](a),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,o)}function g(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function y(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function O(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?y(Object(t),!0).forEach((function(r){g(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):y(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function w(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets option of @rollup/plugin-commonjs appropriately for this require call to behave properly.')}var j=h.default.resolve,k=p.default.pathToRegexp,P=function(e,r){return v.default.sync(j(e,r))},q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,t={};return e.map((function(e){(w(e)||[]).map((function(e){var n,o,c,a,i=(null===(n=e.url)||void 0===n||null===(o=n.trim())||void 0===o?void 0:o.toLowerCase())||"";i=i.replace(/^\//,""),i="".concat(r,"/").concat(i);var u=(null===(c=e.method)||void 0===c||null===(a=c.trim())||void 0===a?void 0:a.toUpperCase())||"GET";t[i]=O(O({},e),{},{url:i,method:u})}))})),t},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;Object.keys(e).forEach((function(t){return r.setHeader(t,e[t])}))},T=function(e,r,t){return m.default.mock("function"==typeof e?e(r,t):e)},C=function(e){return new Promise((function(r){return setTimeout(r,e)}))},E=function(e){try{e=require.resolve(e)}catch(e){console.error(e)}var r=require.cache[e];r&&(r.main&&r.main.children.splice(r.main.children.indexOf(r),1),delete require.cache[require.resolve(e)])},A=function(e){return e=e||{},function(r){var t=[],n=k(r,t,e);return function(e,r){var o,c,a=n.exec(e);if(!a)return!1;r=r||{};for(var i=0;i<t.length;i++)o=t[i],(c=a[i+1])&&(r[o.name]=decodeURIComponent(c),o.repeat&&(r[o.name]=r[o.name].split(o.delimiter)));return r}}},R=x,S=function(e,r,t){if("OPTIONS"===e.method.toLocaleUpperCase())return r.sendStatus(200);t()},D=function(e){return function(r,t,n){var o=O({"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, PATCH, OPTIONS, PUT, DELETE","Access-Control-Allow-Headers":"Content-Type, X-Requested-With,"+(r.header("access-control-request-headers")||""),"Access-Control-Allow-Credentials":"true"},e);R(o,t),n()}},U=p.default.pathToRegexp,I=P,L=q,$=x,H=T,G=C,M=E,N=A,F=S,W=D;return function(e,r,t){if(!r)return console.log(d.default.red("[@bwrong/mock] Please set mockFolder"));var n=t.delay||0,o=t.watchOptions||{},c=t.headers||{},a=t.prefix||"",i=t.pattern||"**/[^_]*.js",u=t.debug||!0,p=I(r,i),h=L(p,a);e.all("".concat(a,"/*"),[f.default.json(),f.default.urlencoded({extended:!0}),F,W(c)],function(){var e,r=(e=regeneratorRuntime.mark((function e(r,t,o){var c,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(c=Object.values(h).find((function(e){return r.method===e.method&&U(e.url).exec(r.path)})))){e.next=9;break}if(r.params=N({sensitive:!1,strict:!1,end:!1})(c.url)(l.default.parse(r.url).pathname),!(a=H(null==c?void 0:c.response,r,t))){e.next=9;break}return e.next=7,G(n);case 7:return c.headers&&$(c.headers,t),e.abrupt("return",t.send(a));case 9:o();case 10:case"end":return e.stop()}}),e)})),function(){var r=this,t=arguments;return new Promise((function(n,o){var c=e.apply(r,t);function a(e){b(c,n,o,a,i,"next",e)}function i(e){b(c,n,o,a,i,"throw",e)}a(void 0)}))});return function(e,t,n){return r.apply(this,arguments)}}()),s.default.watch(r,O({ignoreInitial:!0},o)).on("all",(function(e,r){if("change"===e||"add"===e||"unlink"===e)try{M(r),p.forEach((function(e){return M(e)})),h=L(p,a),u&&console.log("".concat(d.default.green("[@bwrong/mock]")," ").concat(d.default.green(r.replace(process.cwd(),""))," load success！"))}catch(e){console.error(e),console.error("".concat(d.default.red("[@bwrong/mock]")," ").concat(d.default.red(r.replace(process.cwd(),""))," load filed！"))}}))}}));
